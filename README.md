# KintsugiOS

Минималистичная x86 операционная система на (N)ASM и C, созданная в образовательных целях для глубокого понимания принципов работы операционных систем.

<div align="center">
<img src=https://img.shields.io/github/languages/top/alexeev-prog/KintsugiOS>
<img src=https://img.shields.io/github/license/alexeev-prog/KintsugiOS>
<img src=https://img.shields.io/github/stars/alexeev-prog/KintsugiOS>
<img src="https://img.shields.io/github/issues/alexeev-prog/KintsugiOS">
</div>

![KintsugiOS Screenshot](https://via.placeholder.com/800x400/000000/FFFFFF/?text=KintsugiOS+Screenshot)

## Особенности

### Реализовано
- **Загрузчик** с переходом из реального режима в защищённый
- **GDT** (Глобальная таблица дескрипторов)
- **Управление памятью** с двумя аллокаторами:
  - Арена-аллокатор (legacy)
  - Аллокатор на основе связанных блоков памяти
- **Драйверы**:
  - VGA-экран с поддержкой цветного текста
  - Клавиатура (PS/2)
  - Таймер
- **Система прерываний** (IDT, ISR, IRQ)
- **Командная оболочка** "Keramika Shell" с поддержкой команд:
  - `HELP` - список команд
  - `CLEAR` - очистка экрана
  - `END` - остановка CPU
  - `AMALLOC`/`MALLOC` - выделение памяти
  - `FREE` - освобождение памяти
  - `INFO` - информация о системе
  - `MEMDUMP` - дамп памяти
  - И другие...
- **Библиотека LibC** включая:
  - Работу со строками (string.h)
  - Форматированный вывод (stdio.h)
  - Функции памяти (mem.h)

### В разработке
- [ ] Виртуальная память (Paging)
- [ ] Файловая система
- [ ] Многозадачность
- [ ] Пользовательский режим
- [ ] Сетевой стек

## Требования

Для сборки и запуска KintsugiOS необходим следующий инструментарий:

- [Кросс-компилятор i386 ELF GCC](http://newos.org/toolchains/i386-elf-15.1.0-Linux-x86_64.tar.xz)
- FASM 1.73.31 или новее
- NASM 2.16 или новее
- GDB для отладки
- MTools и Xorriso для создания образов дисков
- QEMU или Bochs для эмуляции

Проверить готовность окружения можно скриптом:
```bash
./check-env.sh
```

## Структура проекта

```
src/
├── bootloader/           # Код загрузчика
│   ├── bootsector.asm    # Главная загрузочная запись
│   ├── diskload.asm      # Чтение с диска
│   ├── gdt.asm           # Глобальная таблица дескрипторов
│   ├── kernel_entry.asm  # Точка входа в ядро
│   ├── puts_chars.asm    # Вывод текста (16-бит)
│   ├── puts_chars32.asm  # Вывод текста (32-бит)
│   ├── puts_hex.asm      # Вывод hex-чисел
│   └── switch_to32.asm   # Переход в защищённый режим
└── kernel/               # Ядро ОС
    ├── cpu/              # Центральные модули процессора
    │   ├── idt.[ch]      # Таблица дескрипторов прерываний
    │   ├── interrupt.asm # Обработчики прерываний
    │   ├── isr.[ch]      # Службы прерываний
    │   ├── ports.[ch]    # Работа с портами ввода-вывода
    │   ├── timer.[ch]    # Системный таймер
    │   └── type.h        # Общие типы данных
    ├── drivers/          # Драйверы устройств
    │   ├── keyboard.[ch] # Драйвер клавиатуры
    │   ├── lowlevel_io.[ch] # Низкоуровневый ввод-вывод
    │   └── screen.[ch]   # Драйвер экрана
    ├── kernel/           # Основное ядро
    │   ├── kernel.[ch]   # Главные функции ядра
    │   ├── utils.[ch]    # Вспомогательные утилиты
    └── libc/             # Стандартная библиотека C - KKLIBC (Kintsugi Kernel LibC)
        ├── function.h    # Вспомогательные макросы
        ├── mem.[ch]      # Управление памятью
        ├── stdio.[ch]    # Стандартный ввод-вывод
        └── string.[ch]   # Работа со строками
```

## Сборка и запуск

### Базовая сборка
```bash
make
```

### Создание образа диска и запуск в QEMU
```bash
make run
```

### Запуск в QEMU с отладкой
```bash
make debug
```

### Очистка проекта
```bash
make clean      # Удаление бинарных файлов
make clean_all  # Полная очистка
```

## Отладка

Для отладки KintsugiOS запустите систему в режиме отладки:
```bash
make debug
```

И подключитесь через ваш дебаггер (например gdb).

## Как работает загрузка

1. **BIOS** загружает первый сектор диска (512 байт) по адресу 0x7C00
2. **Загрузчик** инициализирует стек, загружает GDT и переключается в защищённый режим
3. **Ядро** загружается по адресу 0x1000 и получает управление
4. **Ядро** инициализирует драйверы, менеджер памяти и командную оболочку

## Команды оболочки

KintsugiOS включает оболочку "Keramika Shell" со следующими командами:

- `END` - остановка процессора
- `CLEAR` - очистка экрана
- `AMALLOC <size>` - выделение памяти (арена)
- `MALLOC <size>` - выделение памяти (куча)
- `FREE <address>` - освобождение памяти
- `INFO` - информация о системе
- `MEMDUMP` - дамп памяти
- `ECHO <text>` - вывод текста
- `HELP` - справка по командам

## Литература и источники

### Ассемблер
- Зубков С. В. «Assembler для DOS, Windows и Unix»
- [Введение в машинный код](http://wasm.ru/article.php?article=1022001)
- [Программирование на ассемблере под DOS](http://wasm.ru/article.php?article=1022003)

### Язык C
- Керниган Б., Ритчи Д. «Язык программирования C»
- Шилдт Г. «Полный справочник по C»

### Операционные системы
- Таненбаум Э. «Современные операционные системы»
- Таненбаум Э. «Операционные системы: Разработка и реализация»
- [OSDEV Wiki](http://osdev.org)

### Архитектура ЭВМ
- Таненбаум Э. «Архитектура компьютера»
- Гук М. «Аппаратные средства IBM PC. Энциклопедия»

## Лицензия

KintsugiOS распространяется под лицензией MIT. Подробнее см. в файле LICENSE.

## Вклад в проект

Приветствуются issues и pull requests. Перед внесением изменений пожалуйста:
1. Обсудите планируемые изменения в issue
2. Следуйте существующему кодстайлу
3. Добавляйте комментарии на русском языке
4. Тестируйте изменения в QEMU и Bochs

## Благодарности

Особая благодарность сообществу OSDev и авторам учебных материалов, указанных в разделе "Литература и источники".

---

<div align="center">
<sub>Название "Kintsugi" отсылает к японскому искусству восстановления керамики золотым лаком — метафора красоты в несовершенстве и постоянного развития.</sub>
</div>
