# ATA PIO
PIO (Programmed Input/Output) — метод передачи данных между центральным процессором (CPU) и периферийным устройством, например устройством хранения данных Parallel ATA.

Некоторые особенности PIO:

 + Каждый элемент данных передаётся по инициативе программы, для каждой транзакции участвует CPU.
 + Интерфейс PIO включает разные режимы, которые соответствуют различным скоростям передачи.
 + Все устройства ATA поддерживают самый медленный режим — Mode 0. С его помощью CPU может определить максимальную скорость передачи данных для устройства и настроить контроллер ATA для оптимальной  + производительности.
 + Режимы PIO не требуют специальных драйверов и подходят для однозадачных операционных систем.

Главным недостатком PIO считается то, что передачей данных управляет процессор, что существенно увеличивает его загрузку.

Первые режимы PIO (0, 1 и 2) были описаны в первоначальной редакции стандарта ATA. В более поздней версии ATA-2 (EIDE или Fast ATA) появились два новых и более быстрых режима PIO (3 и 4).

Интерфейс PIO сгруппирован по различным режимам, которые соответствуют различным скоростям передачи . Электрическая сигнализация в разных режимах одинакова - сокращается только время цикла между транзакциями для достижения более высокой скорости передачи. Все устройства ATA поддерживают самый медленный режим - Mode 0. Получая доступ к информационным регистрам (используя режим 0) на диске ATA, центральный процессор может определить максимальную скорость передачи данных для устройства и настроить контроллер ATA для оптимальной производительности.

Режимы PIO требуют больших затрат ресурсов процессора для настройки транзакции данных и их передачи. Из-за этой неэффективности для повышения производительности был создан интерфейс DMA (и, в конечном итоге, интерфейс Ultra Direct Memory Access (UDMA)). Простая цифровая логика, необходимая для реализации передачи PIO, по-прежнему делает этот метод передачи полезным и сегодня, особенно если высокие скорости передачи не требуются, как в встраиваемых системах , или с программируемыми в полевых условиях вентильными матрицами (FPGA), где режим PIO может использоваться без существенной потери производительности.

В спецификации 2.0 CompactFlash были определены два дополнительных расширенных режима синхронизации. Это режимы PIO 5 и 6. Они специфичны для CompactFlash.

---

Предложенный в конце 80-х годов интерфейс ATA (AT Attachment), известный также под названием IDE (Integrated Drive Electronics) очень быстро завоевал широкую популярность среди производителей и пользователей персональных компьютеров. Основными причинами быстрого и широкого распространения нового интерфейса послужили невысокая цена устройств, простота их установки и эксплуатации, а также высокий уровень совместимости устройств IDE. Спецификация АТА уступает по скорости обмена с дисками и ряду других параметров интерфейсу SCSI, однако для большинства пользователей производительность играет меньшую роль, по сравнению с совместимостью, простотой и стоимостью устройств.

Первоначальная версия стандарта IDE обеспечивала возможность подключения к компьютеру четырех винчестеров и позволяла обмениваться данными с диском на скорости до 10Мбайт/сек, однако реальная скорость ограничивалась прежде всего возможностями самого винчестера. Подключение четырех устройств, предусмотренное спецификацией IDE, в компьютерах семейства IBM PC AT, в спецификации ATA/IDE реализовано не было. Кроме того, совместное использование стандарта ATA и программного интерфейса Int 13 BIOS ограничивало размер дисковых устройств 528Мб.

Другим существенным ограничением стандарта IDE/ATA является невозможность подключения к контроллеру IDE каких-либо устройств, за исключением винчестеров.

Присущие интерфейсу IDE/ATA ограничения тормозили развитие недорогих компьютерных систем, рассчитанных на массового пользователя, в связи с чем целый ряд фирм предпринял попытки расширения возможностей классического IDE. Наибольших успехов на этом пути добилась компания Western Digital, разработавшая спецификацию Enhanced IDE (EIDE), позволяющую использовать диски, размер которых превышает 528 Мб, и обеспечившую реальную возможность подключения к компьютеру до четырех устройств IDE (не только винчестеров, но и приводов CD-ROM или стриммеров).

Другим интересным вариантом развития интерфейса IDE является технология Fast ATA, разработанная компанией Seagate Technology при поддержке фирмы Quantum. Эта технология направлена в первую очередь на повышение скорости обмена данными с дисковыми устройствами и не поддерживает возможность подключения CD-ROM или стриммеров, но обеспечивает более высокий уровень совместимости за счет соответствия широко распространенным промышленным стандартам.

## Enhanced IDE

Технология Enhanced IDE компании Western Digital была разработана в результате анализа потребностей современного рынка ПК. В 1984 году компания Western Digital создала контроллеры дисководов (WD1002) и винчестеров (ST506), которые были использованы фирмой IBM при разработке компьютера IBM PC AT. Успех архитектуры АТ привел к значительному расширению рынка IBM-совместимых ПК и сделал контроллеры Western Digital стандартом de facto.

В процессе становления рынка персональных компьютеров фирма Western Digital пришла к выводу о необходимости интеграции электроники контроллера АТ и дискового устройства. В результате сотрудничества с Compaq Computer Corporation был разработан интерфейс IDE (Integrated Drive Electronics), называемый также АТА (AT Bus attachment). Первые промышленные устройства на базе IDE/ATA были выпущены в 1986 году.

Продолжая лидировать в сфере IDE-устройств, компания Western Digital предложила расширение интерфейса IDE. Новая спецификация - Enhanced IDE - повышает скорость обмена с диском, допускает применение более скоростных дисков и обеспечивает возможность установки в компьютере до четырех устройств IDE. Кроме того, Enhanced IDE позволяет подключать к контроллеру не только винчестеры, но и другие устройства (приводы CD-ROM, стриммеры), поддерживающие спецификацию ATAPI (AT Attachment Packet Interface). Эта спецификация определяет интерфейс с приводами CD-ROM и другими недисковыми устройствами, позволяющий использовать стандартные контроллеры и кабели. Стандарт ATAPI получил широкую поддержку среди производителей CD-ROM-устройств и разработчиков операционных систем, что еще более расширило сферу распространения интерфейса IDE/ATA. Текст спецификации ATAPI можно найти на сервере ftp://fission.dt.wdc.com/pub/standarts/atapi/atapi25.zip

Спецификация EIDE позволяет избавиться от целого ряда ограничений, присущих интерфейсу IDE/ATA. Такое расширение обеспечивает существенный рост возможностей устройств долговременного хранения информации без роста цен, усложнения использования и потери совместимости. Ограничения, присущие IDE, по сравнению с другими интерфейсами (такими, как SCSI) не угрожают доминированию IDE на современном рынке недорогих систем. Однако повышение производительности процессоров, разработка новых ОС и высокие запросы современных приложений к дисковому пространству привели к тому, что стандарт IDE уже не может удовлетворять всем современным требованиям. Существенно и то, что стандартный интерфейс IDE менее гибок и более ограничен по сравнению со SCSI:

IDE поддерживает только два винчестера, а SCSI обеспечивает возможность подключения большого количества блочных устройств различных типов (принтеры, CD-ROM, стриммеры и др.);
размер дисков IDE не может превышать 528Мб, поскольку для доступа к диску используется интерфейс Int 13 BIOS, тогда как SCSI не ограничивает размер диска;
IDE обеспечивает скорость обмена с диском 2-3 Мб/сек, а SCSI - 10 или 20Мб/сек (Fast/Wide).

Технология Enhanced IDE позволяет избавиться от основных ограничений стандарта IDE/ATA:

 - предельный размер диска 528Мб;
 - малая скорость обмена с диском;
 - поддержка только двух устройств;
 - невозможность подключения приводов CD-ROM и стриммеров.

1. Использование винчестеров размером более 528Мб.
Эта возможность обусловлена внесенными в BIOS изменениями, позволяющими адресовать большие диски. Для работы с дисками более 528Мб требуется поддержка со стороны винчестера, BIOS и операционной системы.

Винчестер должен поддерживать спецификацию ATA (этому требованию удовлетворяет большинство современных винчестеров).

BIOS также должна поддерживать спецификацию ATA; большинство производителей системных плат и разработчиков BIOS уже поддерживают этот режим.

Может потребоваться поддержка работы с большими дисками и со стороны операционной системы. Windows 3.1 не полностью соответствует ATA, поэтому приходится использовать специальные драйверы (Windows "32-bit disk access"), обычно поставляемые вместе с контроллерами EIDE. Большинство 32-разрядных операционных систем (таких, как OS/2) изначально поддерживают работу с большими дисками.

2. Ускоренный обмен данными
основан на использовании скоростных режимов программируемого ввода-вывода (PIO mode 3) и прямого доступа к памяти (DMA mode 1). Эти режимы обеспечивают скорость обмена 11.1 и 13.3 Мб/сек, соответственно. Для реализации скоростного обмена требуется поддержка со стороны винчестера и BIOS.

BIOS должна поддерживать один из скоростных режимов обмена с диском (PIO mode 3 или DMA mode 1), как правило это режим PIO.

Со стороны дискового устройства также должна обеспечиваться поддержка скоростного обмена. Эту возможность обеспечивает большинство современных винчестеров (в том числе диски Fast ATA).

Скоростные режимы обмена позволяют полнее реализовать возможности дисковых контроллеров, использующих широкополосную локальную шину VESA или PCI.

3. Поддержка двух портов ATA.
Для обеспечения этой возможности используются зарезервированные для второго контроллера адреса портов ввода-вывода и прерывание IRQ15. Для реализации этой возможности требуется поддержка со стороны контроллера (хост-адаптера), BIOS и операционной системы.

К самим устройствам (винчестерам, приводам CD-ROM или стриммерам) не предъявляется никаких дополнительных требований.

Контроллер должен обеспечивать возможность установки адресов второго порта (это реализовано отнюдь не во всех современных моделях).

Не все BIOS поддерживают возможность использования четырех устройств IDE, однако современные разработки включают этот режим.

Важную роль играет поддержка использования четырех устройств со стороны операционной системы. Эта возможность реализована в большинстве 32-разрядных ОС и в последних версиях DOS.

4. Возможность подключения приводов CD-ROM и стриммеров.
Этот режим является недорогой альтернативой SCSI. Для обеспечения такой возможности требуется требуется поддержка нескольких новых команд. Спецификация ATAPI (ATA Packet Interface), находящаяся в стадии разработки, содержит описание новых команд.

Для обеспечения возможности подключения к хост-адаптеру недисковых устройств требуется поддержка спецификации ATAPI со стороны BIOS, хост-адаптера, операционной системы и самих периферийных устройств.

В настоящее время большинство устройств CD-ROM уже использует интерфейс IDE/ATAPI для подключения ко второму порту современных контроллеров.

Очевидно, что при таком обилии вариантов расширения возможностей IDE отнюдь не все устройства, рекламируемые как "Enhanced", поддерживают все четыре режима, добавленные в спецификацию Enhanced IDE. Не следует забывать также о том, что для обеспечения полной поддержки EIDE, этой спецификации должны удовлетворять BIOS, хост-адаптер, операционная система и, наконец, сами периферийные устройства.

## Ссылки

 - [FlingOS Conceptual Docs ATA](http://flingos.co.uk/docs/reference/ATA/)
 - [Wikipedia Programmed input–output](https://en.wikipedia.org/wiki/Programmed_input%E2%80%93output)
 - [Современные реализации ATA/IDE](https://citforum.ru/hardware/bookide/bookide3.shtml)
 - [Режимы обмена данными PIO параллельного ATA](https://infopedia.su/8x1be5.html)
 - [Интерфейс IDE (современные реализации)](https://de.ifmo.ru/bk_netra/page.php?index=76&tutindex=28)
 - [ATA для дZенствующих. Часть 1](https://wasm.in/blogs/ata-dlja-dzenstvujuschix-chast-1.335/)
